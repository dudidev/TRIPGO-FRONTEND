<app-nav></app-nav>

<div class="empresa-page">

  <!-- LOADING -->
  <div *ngIf="loading" class="card">Cargando...</div>

  <!-- ERROR -->
  <div *ngIf="!loading && errorMessage" class="card">
    <p class="empty">{{ errorMessage }}</p>
  </div>

  <!-- âœ… CARDS: si tiene MÃS de 1 y AÃšN NO hay seleccionado -->
  <div
    *ngIf="!loading && !errorMessage && establecimientos.length > 1 && !establecimientoOriginal"
    class="card"
  >
    <h2 class="cards-title">Selecciona el establecimiento</h2>

    <div class="cards-grid">
      <button
        type="button"
        class="est-card"
        *ngFor="let est of establecimientos"
        (click)="seleccionarEstablecimiento(est)"
      >
        <div class="est-card__head">
          <h3 class="est-card__name">{{ est.nombre_establecimiento }}</h3>
          <span class="est-card__badge">{{ est.estado || 'activo' }}</span>
        </div>

        <p class="est-card__meta">ğŸ“ {{ est.ubicacion || 'â€”' }}</p>
        <p class="est-card__meta">ğŸ·ï¸ Tipo: {{ est.tipo || 'â€”' }}</p>

        <div class="est-card__cta">Administrar â†’</div>
      </button>
    </div>
  </div>

  <!-- âœ… EDITOR: solo si ya hay seleccionado -->
  <div *ngIf="!loading && !errorMessage && establecimientoOriginal" class="card">

    <div class="panel-header">
      <div>
        <h2>{{ establecimientoOriginal.nombre_establecimiento }}</h2>
        <p class="muted">ğŸ“ {{ establecimientoOriginal.ubicacion }}</p>
      </div>

      <!-- âœ… Acciones a la derecha -->
      <div class="actions">

        <!-- âœ… volver a cards si tiene varios -->
        <button
          *ngIf="establecimientos.length > 1 && !editMode"
          class="btn-secundario"
          (click)="volverALista()"
        >
          â† Volver a mis establecimientos
        </button>

        <button *ngIf="!editMode" (click)="editar()">Editar</button>

        <ng-container *ngIf="editMode">
          <button (click)="guardarCambios()" [disabled]="saving">
            {{ saving ? 'Guardando...' : 'Guardar' }}
          </button>

          <button class="btn-secundario" (click)="cancelar()" [disabled]="saving">
            Cancelar
          </button>
        </ng-container>
      </div>
    </div>

    <div class="contenido">

      <!-- IZQUIERDA -->
      <div class="col-izq">

        <section>
          <h3>DescripciÃ³n general</h3>

          <p *ngIf="!editMode">{{ establecimientoOriginal.descripcion || 'â€”' }}</p>

          <textarea
            *ngIf="editMode"
            rows="6"
            [(ngModel)]="establecimientoEdit.descripcion"
          ></textarea>
        </section>

        <section>
          <h3>Datos de contacto</h3>

          <p>
            <b>TelÃ©fono:</b>
            <span *ngIf="!editMode">{{ establecimientoOriginal.telefono || 'â€”' }}</span>
            <input *ngIf="editMode" [(ngModel)]="establecimientoEdit.telefono" />
          </p>

          <p>
            <b>Correo:</b>
            <span *ngIf="!editMode">{{ establecimientoOriginal.correo || 'â€”' }}</span>
            <input *ngIf="editMode" [(ngModel)]="establecimientoEdit.correo" />
          </p>

          <p>
            <b>Estado:</b>
            <span *ngIf="!editMode">{{ establecimientoOriginal.estado || 'activo' }}</span>

            <select *ngIf="editMode" [(ngModel)]="establecimientoEdit.estado">
              <option value="activo">activo</option>
              <option value="inactivo">inactivo</option>
            </select>
          </p>
        </section>

      </div>

      <!-- DERECHA -->
      <div class="col-der">

        <section class="box">
          <h4>InformaciÃ³n bloqueada</h4>

          <p><b>Nombre:</b> {{ establecimientoOriginal.nombre_establecimiento }}</p>
          <p><b>UbicaciÃ³n:</b> {{ establecimientoOriginal.ubicacion }}</p>
          <p><b>DirecciÃ³n:</b> {{ establecimientoOriginal.direccion || 'â€”' }}</p>
          <p><b>Tipo:</b> {{ establecimientoOriginal.tipo || 'â€”' }}</p>
        </section>

        <section class="box">
          <h4>Horarios</h4>

          <!-- Vista -->
          <ng-container *ngIf="!editMode">
            <ul>
              <li *ngFor="let d of diasSemana">
                {{ d }}: {{ establecimientoOriginal.horario_apertura || 'â€”' }} - {{ establecimientoOriginal.horario_cierre || 'â€”' }}
              </li>
            </ul>
          </ng-container>

          <!-- EdiciÃ³n (solo horas, dÃ­as fijos) -->
          <ng-container *ngIf="editMode">
            <div class="field">
              <label>Hora apertura</label>
              <input [(ngModel)]="establecimientoEdit.horario_apertura" />
            </div>

            <div class="field">
              <label>Hora cierre</label>
              <input [(ngModel)]="establecimientoEdit.horario_cierre" />
            </div>

            <p class="hint">Los dÃ­as se muestran fijos por ahora; solo editas las horas.</p>
          </ng-container>
        </section>

      </div>

    </div>
  </div>

</div>

<app-footer></app-footer>