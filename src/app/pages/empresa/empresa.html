<app-header></app-header> 

<div class="detalle-container">

  <!-- Header + acciones -->
  <div class="empresa-top">
    <div class="empresa-title">
      <!-- Vista -->
      <h1 *ngIf="!editMode">{{ establecimiento.nombre_establecimiento }}</h1>

      <!-- Edici√≥n -->
      <div *ngIf="editMode" class="field">
        <label>Nombre</label>
        <input class="input" [(ngModel)]="establecimientoEdit.nombre_establecimiento" />
      </div>

      <p class="direccion" *ngIf="!editMode">üìç {{ establecimiento.ubicacion }}</p>

      <div *ngIf="editMode" class="field">
        <label>Ubicaci√≥n</label>
        <input class="input" [(ngModel)]="establecimientoEdit.ubicacion" />
      </div>
    </div>

    <div class="empresa-actions">
      <button class="btn-itinerario" *ngIf="!editMode" (click)="editar()">Editar</button>
      <ng-container *ngIf="editMode">
        <button class="btn-itinerario" (click)="guardar()">Guardar</button>
        <button class="btn-secundario" (click)="cancelar()">Cancelar</button>
      </ng-container>
    </div>
  </div>

  <!-- IM√ÅGENES -->
  <div class="imagenes" *ngIf="!editMode && establecimiento.imagenes?.length; else imagesEdit">
    <img class="principal" [src]="establecimiento.imagenes[0]" [alt]="establecimiento.nombre_establecimiento" />

    <div class="secundarias" *ngIf="establecimiento.imagenes.length > 1">
      <img *ngFor="let img of establecimiento.imagenes.slice(1)" [src]="img" [alt]="establecimiento.nombre_establecimiento" />
    </div>
  </div>

  <ng-template #imagesEdit>
    <div class="box" *ngIf="editMode; else noImages">
      <h4>Im√°genes</h4>

      <div class="list">
        <div class="list-item" *ngFor="let img of establecimientoEdit.imagenes; let i = index">
          <span class="truncate">{{ img }}</span>
          <button class="btn-mini" (click)="removeImagen(i)">Eliminar</button>
        </div>
      </div>

      <div class="add-row">
        <input class="input" [(ngModel)]="nuevaImagen" placeholder="URL de imagen..." />
        <button class="btn-mini" (click)="addImagen()">Agregar</button>
      </div>
    </div>

    <ng-template #noImages>
      <div class="imagenes imagenes--empty">
        <p>No hay im√°genes disponibles todav√≠a.</p>
      </div>
    </ng-template>
  </ng-template>

  <div class="contenido">

    <!-- IZQUIERDA -->
    <div class="col-izq">

      <section>
        <h3>Descripci√≥n general</h3>

        <p class="descripcion" *ngIf="!editMode">{{ establecimiento.descripcion }}</p>

        <div *ngIf="editMode" class="field">
          <label>Descripci√≥n</label>
          <textarea class="textarea" rows="7" [(ngModel)]="establecimientoEdit.descripcion"></textarea>
        </div>
      </section>

      <section>
        <h3>Ubicaci√≥n</h3>

        <div class="mapa" *ngIf="!editMode">
          <ng-container *ngIf="establecimiento.lat != null && establecimiento.lng != null; else noUbicacion">
            <app-mapa
              [lat]="establecimiento.lat"
              [lng]="establecimiento.lng"
              [zoom]="15"
              [label]="establecimiento.nombre_establecimiento"
              [openOnClick]="true"
            ></app-mapa>
          </ng-container>

          <ng-template #noUbicacion>
            <p>Ubicaci√≥n no disponible por ahora.</p>
          </ng-template>
        </div>

        <div *ngIf="editMode" class="grid-2">
          <div class="field">
            <label>Lat</label>
            <input class="input" type="number" [(ngModel)]="establecimientoEdit.lat" />
          </div>
          <div class="field">
            <label>Lng</label>
            <input class="input" type="number" [(ngModel)]="establecimientoEdit.lng" />
          </div>
        </div>
      </section>

    </div>

    <!-- DERECHA -->
    <div class="col-der">

      <!-- Informaci√≥n relevante -->
      <section class="box" *ngIf="!editMode; else editDatos">
        <h4>Informaci√≥n relevante</h4>
        <ul>
          <li *ngFor="let d of establecimiento.datosGenerales">{{ d }}</li>
        </ul>
      </section>

      <ng-template #editDatos>
        <section class="box">
          <h4>Informaci√≥n relevante</h4>

          <div class="list">
            <div class="list-item" *ngFor="let d of establecimientoEdit.datosGenerales; let i = index">
              <span class="truncate">{{ d }}</span>
              <button class="btn-mini" (click)="removeDato(i)">Eliminar</button>
            </div>
          </div>

          <div class="add-row">
            <input class="input" [(ngModel)]="nuevoDato" placeholder="Ej: Tel√©fono: +57..." />
            <button class="btn-mini" (click)="addDato()">Agregar</button>
          </div>
        </section>
      </ng-template>

      <!-- Promociones -->
      <section class="box" *ngIf="!editMode; else editPromo">
        <h4>Algunas promociones</h4>
        <p>{{ establecimiento.promociones || 'No hay promociones disponibles por ahora.' }}</p>
      </section>

      <ng-template #editPromo>
        <section class="box">
          <h4>Algunas promociones</h4>
          <textarea class="textarea" rows="3" [(ngModel)]="establecimientoEdit.promociones"></textarea>
        </section>
      </ng-template>

      <!-- Horarios -->
      <section class="box" *ngIf="!editMode; else editHours">
        <h4>Horarios</h4>
        <ul>
          <li *ngFor="let h of establecimiento.horarios">{{ h }}</li>
        </ul>
      </section>

      <ng-template #editHours>
        <section class="box">
          <h4>Horarios</h4>

          <div class="list">
            <div class="list-item" *ngFor="let h of establecimientoEdit.horarios; let i = index">
              <span class="truncate">{{ h }}</span>
              <button class="btn-mini" (click)="removeHorario(i)">Eliminar</button>
            </div>
          </div>

          <div class="add-row">
            <input class="input" [(ngModel)]="nuevoHorario" placeholder="Ej: Lunes: 9AM - 6PM" />
            <button class="btn-mini" (click)="addHorario()">Agregar</button>
          </div>
        </section>
      </ng-template>

      <!-- Datos b√°sicos (como en tu panel actual) -->
      <section class="box" *ngIf="!editMode; else editBasicos">
        <h4>Datos de contacto</h4>
        <p><b>Direcci√≥n:</b> {{ establecimiento.direccion }}</p>
        <p><b>Tel√©fono:</b> {{ establecimiento.telefono }}</p>
        <p><b>Correo:</b> {{ establecimiento.correo || '‚Äî' }}</p>
        <p><b>Apertura:</b> {{ establecimiento.horario_apertura || '‚Äî' }}</p>
        <p><b>Cierre:</b> {{ establecimiento.horario_cierre || '‚Äî' }}</p>
      </section>

      <ng-template #editBasicos>
        <section class="box">
          <h4>Datos de contacto</h4>

          <div class="field">
            <label>Direcci√≥n</label>
            <input class="input" [(ngModel)]="establecimientoEdit.direccion" />
          </div>

          <div class="field">
            <label>Tel√©fono</label>
            <input class="input" [(ngModel)]="establecimientoEdit.telefono" />
          </div>

          <div class="field">
            <label>Correo</label>
            <input class="input" [(ngModel)]="establecimientoEdit.correo" />
          </div>

          <div class="grid-2">
            <div class="field">
              <label>Horario apertura</label>
              <input class="input" [(ngModel)]="establecimientoEdit.horario_apertura" />
            </div>
            <div class="field">
              <label>Horario cierre</label>
              <input class="input" [(ngModel)]="establecimientoEdit.horario_cierre" />
            </div>
          </div>
        </section>
      </ng-template>

    </div>

  </div>
</div>

<app-footer></app-footer>